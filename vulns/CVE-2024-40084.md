# [CVE-2024-40084](https://www.cve.org/CVERecord?id=CVE-2024-40084): Buffer Overflow in Boa Webserver
* **CVSS Score** - 9.6, Critical ([CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H))
* **Overview** - the custom TCP service running on port 5432 has several functions, one of which includes spinning up a webserver stored at `/hualai/boa/boa` on port 8023. Since this service has no authentication, anyone can spin up the webserver. When an invalid HTTP request is made to this server (invalid method or path), the invalid field is unsafely copied into a buffer that is sent back to this user, causing an overflow. 
* **Description**
    * 8192 bytes are read from the HTTP request to be processed by the server. The first 3 strings are processed as the method, URI, and HTTP version. However, if the method is not `GET` or `POST`, or the URI path references a file that does not exist relative to the `/tmp` directory, a function is called to return that error to the user. 
    * Inside this unnamed function (address 0x4026d0 in latest firmware), a buffer with 8192 bytes is allocated for the response. Over 150 bytes of this buffer is allocated using hard-coded HTML strings, after which the invalid header/path is copied in using the `%s` format identifier. Since the method can be up to 8192 bytes, this leads to an overflow of just over 100 bytes, enough to overwrite the return address stored on the stack and control the `$pc` pointer. There are no stack canaries present.
* **Steps to Reproduce**
    * Running the command `curl https://192.168.58.1:8023/$(printf 'A%.0s' {1..8000}) -k` will return an "Empty reply from server" since the forked child process has segfaulted.
* **Impact** - Anyone with regular access to the WiFi (LAN) can exploit this buffer overflow and gain root access to the Vilo router through Remote Code Execution.