# [CVE-2024-40086](https://www.cve.org/CVERecord?id=CVE-2024-40086): Buffer Overflow in `local_app_set_router_wifi_SSID_PWD()`
* **CVSS Score** - 9.6, Critical ([CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H))
* **Overview** - An attacker connected to the router's LAN can interact with the local service running on port 5432. When setting the password for the WiFi, the value of the JSON field `password` is never length checked. Instead, `strlen()` is used to find the length of password and the `memcpy()` function is used to copy the password into a fixed-size buffer of 64 bytes. Therefore, a password longer than 64 bytes will lead to stack memory corruption.
* **Description**
    * Anyone on the LAN can interact with the service running on port 5432, which uses a custom protocol to receive commands from the user's Vilo app mainly for setup purposes. An unauthenticated attacker can implement this protocol (which uses XXTEA encryption) to send custom messages and commands through this service. One of the commands it takes is changing the WiFi SSID and password values. While the SSID only has 32 bytes copied over into a 32-byte buffer (avoiding a buffer overflow), the arbitrary-length password field is copied over insecurely.
    * The message sent to the `local_app_set_router_wifi_SSID_PWD()` function is a JSON payload like `{"ssid": "asdf", "password": "pwd"}`. The `strlen()` function is used to determine the length of the `password` field, and then that many bytes are copied over into a fixed-size buffer of 64 bytes, leading to a buffer overflow.
    * This means a payload like `{"ssid":"asdf", "password": "AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"}` would overflow the buffer and modify the stack. In the latest version of the firmware, stack canaries are present; in older versions, there are no canaries. 
* **Impact** - Anyone with regular access to the WiFi (LAN) can exploit this buffer overflow and may be able to gain root access to the Vilo router through Remote Code Execution.